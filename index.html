<!DOCTYPE html>
<html>

<head>
  <meta charset=utf-8 />
  <title>USAW National Championship participation</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css" />

  <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>

  <style>
    body {
            margin: 0;
            padding: 0;
            /*background: #152C53;*/
            background-image: linear-gradient(#152C53, #f1f1f2);
            font-family: Lato, sans-serif;
            color: #0D0000;
        }
      .header {
          margin-top: 6rem;
          text-align: center; 
        }

      .info {
          text-align: center;
          padding: 8px 5px;
          /*border: 2px solid rgba(244, 244, 244, 0.2);*/
          background: rgb(180, 0, 0);
          color: white;
          border-radius: 5px;
          margin-top: 10px;
          z-index: 9999;
      }
        h1 {
          color: whitesmoke;
          
        }

        h2 {
            
            color: rgb(160, 160, 160);
            
        }

        h3 {
            
            color: red;
            
            
        }

        #map {
            width: 100%;
            height: 720px;
            border: 5px solid white;
             border-radius: 5px;
        }

        .subtitle {
            font-size: .5em;
        }

        footer {
            padding: 6px 10%;
            width: 80%;
        }

        p {
            font-size: 1em;
            color: #001323;
        }

        .information {
          text-align: left;
          padding: 8px 5px;
          border: 2px solid rgba(244, 244, 244, 0.2);
          background: white;
          color: black;
          border-radius: 5px;
          margin-top: 10px;
          z-index: 9999;
      }

        
        .legend {
            padding: 6px 8px;
            font-size: 1em;
            background: rgba(75, 75, 75, 0.8);
            color: whitesmoke;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            width: 160px;
        }

        .legend h3 {
            font-size: 1.1em;
            font-weight: bold;
            line-height: 1em;
            color: whitesmoke;
            margin: 0;
        }

        .legend h3 span {
            font-size: 1.3em;
            margin: 0 20px 0 0;
        }

        .legend ul {
            list-style-type: none;
            padding: 0;
            margin: 12px 4px 0;
        }

        .legend li {
            height: 22px;
        }

        .legend li span {
            width: 30px;
            height: 20px;
            float: left;
            margin-right: 10px;
        }

        .subtitle .min {
            float: left;
        }

        #ui-controls {
            
            padding: 8px 25px 8px 15px;
            border: 0px solid gray;
            background: rgba(75, 75, 75, 0.8);
            border-radius: 5px;
            color: whitesmoke;
        }
        
        #ui-controls .min {
            float: left;
            
        }

        #ui-controls .max {
            float: right;
            margin-right: 15px;
        }

       .year-slider {
          -webkit-appearance: none;
          
          padding: 0px;
          margin: 5px;
          
        }

        .year-slider::-webkit-slider-runnable-track {
          width: 800px;
          height: 5px;
          background: whitesmoke;
          border: none;
          border-radius: 5px;
          tick
        }

        .year-slider::-webkit-slider-thumb {
          -webkit-appearance: none;
          border: none;
          height: 16px;
          width: 16px;
          border-radius: 50%;
          background: red;
          margin-top: -4px;
}

        label {
            font-size: 1.1em;
            font-weight: bold;
        }
    </style>
</head>

<body>
  <div class="container">
    <section class="header">
      <div class="twelve columns">
      <h1 class="title">
      Where are the strongest Weightlifters in America From? <br>
      </h1>
      <h2>USAW National Championship Participation by State: 2014-2019</h2>
      </div>
    </section>

    <div class="row">
      <div id="map" class="six columns"></div>
    </div> <!--close out row for map -->

    <section class="row">
      <div class="six columns">
        <h3 class="info">Data Source and Method</h3>
        
        <p class="information">This map shows the number of weightlifters who attended...   Data from <a
            target="_blank" href="https://www.census.gov/topics/employment/labor-force/about/glossary.html">USA Weightlifting</a>
          meet results.</p>
          <ul class="information">
            <li>Map authored by: Hope Stremcha</li>
            <li>Created: April 2019</li>
            <li>Data source: <a target="_blank" href="https://factfinder.census.gov">United States Census Bureau</a></li>
          </ul>
      </div>
      <div class="six columns u-pull-right">
        <h3 class="info">More Information</h3>
        <p class="information">
          jilkad flating </p>
      </div> 
    </section>

 
    <div class="row">
  <div id ="ui-controls" class="six columns">
    <label><span class="min">2014</span><span class="max">2019</span>
    <input type="range" min="2014", max="2019", value="2014", step="1" class="year-slider" >
    </label> 
  </div> <!--close ui controls-->
  </div> <!--close row-->
  </div> <!--close out container-->
  
  
  

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.3.6/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.5/chroma.min.js"></script>
  <script>
    // map options
    var options = {
      scrollWheelZoom: true,
      zoomSnap: .1,
      dragging: true,
      zoomControl: false,
      center: [38, -98],
      zoom: 3
    }

    // create the Leaflet map
    var map = L.map('map', options);

    // request tiles and add to map
    var tiles = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ',
      subdomains: 'abcd',
      ext: 'png'
    }).addTo(map);

    var zoom = L.control.zoom({
         position: 'topleft'
         }).addTo(map);

    // AJAX request for GeoJSON data
    $.getJSON("data/states.geojson", function(states) {
        Papa.parse('data/participation-by-state.csv', {

          download: true,
          header: true,
          complete: function (data) {

            processData(states, data);

        }

      }); // end of Papa.parse()
      
     }) // end of getJSON

    .fail(function() {
      console.log("the data file failed to load")
    }); // end of $.getJSON()

    function processData(states, data) {
      // loop through all the states
      for (var i = 0; i < states.features.length; i++) {

        // short-hand reference to state properties
        var props = states.features[i].properties;

        // for each of the CSV data rows
        for (var j = 0; j < data.data.length; j++) {

          // if the state fips code and data fips code match
          if (props.STATEFP === data.data[j].STATE_FIP) {
            //reassign the data for that state as the state's properties
            states.features[i].properties = data.data[j];
            // end loop
            break;
        
          } //end reassign
        } //end inner loop
      } // end outer loop
      
      // empty array to store all the data values
      var rates = [];

      // iterate through all the states
      states.features.forEach(function (state) {

        // iterate through all the props of each state
        for (var prop in state.properties) {

          // if the attribute is a number and not one of the fips codes or name
          if(+prop)  {

            // push that attribute value into the array
            rates.push(+state.properties[prop]);
          } //end if
        }// end loop
      });
      var breaks = chroma.limits(rates, 'q', 5);

      var colorize = chroma.scale(chroma.brewer.Blues).classes(breaks).mode('lab');
      drawMap(states, colorize);
      drawLegend(breaks, colorize);
    } //end function processData

    function drawMap(states, colorize) {

      // create Leaflet object with geometry data and add to map
      var dataLayer = L.geoJson(states, {
        style: function(feature) {

          return {
           color: '#1e1e1e',
           weight: 1,
           fillOpacity: 1,
           fillColor: 'blue'
          };
       },
      onEachFeature: function (feature, layer) {

          // when mousing over a layer
          layer.on('mouseover', function () {

            // change the stroke color and bring that element to the front
            layer.setStyle({
              color: 'red'
            }).bringToFront();
          });

          // on mousing off layer
          layer.on('mouseout', function () {

            // reset the layer style to its original stroke color
            layer.setStyle({
              color: '#1e1e1e'
            });
          });

        }


      }).addTo(map);
      updateMap(dataLayer, colorize, '2014');
      addUI(dataLayer, colorize);
     
    } // end function drawMap()

    function updateMap(dataLayer, colorize, currentYear) {
      //loop through each county
      dataLayer.eachLayer(function (layer) {

        var props = layer.feature.properties;
        // set the fill color of layer based on its normalized data value
        layer.setStyle({
          fillColor: colorize(Number(props[currentYear]))
        });
        layer.bindTooltip("<b>" + layer.feature.properties.Name + "</b><br>" + layer.feature.properties[currentYear] + " Weightlifters");
      }) 
    }// end updateMap()

    function drawLegend(breaks, colorize) {
        var legendControl = L.control({
        position: 'topright'
      });
      legendControl.onAdd = function (map) {

        var legend = L.DomUtil.create('div', 'legend');
        return legend;

      };

      legendControl.addTo(map);
        var legend = $('.legend').html("<h3><span>2014</span><br># Weightlifters per State at Nationals</h3><ul>");

      for (var i = 0; i < breaks.length - 1; i++) {

        var color = colorize(breaks[i], breaks);

        var classRange = '<li><span style="background:' + color + '"></span> ' +
          breaks[i].toLocaleString() + ' &mdash; ' +
          breaks[i + 1].toLocaleString() + '</li>'

        $('.legend ul').append(classRange);
      }

      legend.append("</ul>");

      } // end drawLegend()

      function addUI(dataLayer, colorize) {
        var sliderControl = L.control({
          position: 'bottomleft'
        });

        sliderControl.onAdd = function(map) {
          var slider = L.DomUtil.get("ui-controls");
          // disable scrolling of the map while using controls
          L.DomEvent.disableScrollPropagation(slider);
          // disable click events while using control
         L.DomEvent.disableClickPropagation(slider);
          return slider;
        }
        $(".year-slider")
          .on("input change", function(){
            var currentYear = this.value
            $('.legend h3 span').html(currentYear);
            updateMap(dataLayer, colorize, currentYear);
          });
        sliderControl.addTo(map); 

      } // end createSliderUI()*/



  </script>

</body>

</html>
